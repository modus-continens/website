<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Sergey Mechtaev">
  <title>Modus</title>

	<!-- <link href="https://unpkg.com/prismjs@v1.x/themes/prism.css" rel="stylesheet" /> -->

  <link href="assets/dist/css/prism-vs.css" rel="stylesheet" />



  <!-- Bootstrap core CSS -->
  <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Place this tag in your head or just before your close body tag. -->

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>

  <!-- Custom styles for this template -->
  <link href="modus.css" rel="stylesheet">
</head>

<nav class="navbar navbar-expand-lg navbar-light modus-bg mb-0" aria-label="Modus navbar">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#modusNavbar"
      aria-controls="navbarsExample07" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="modusNavbar">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="https://docs.modus-continens.com">Docs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/modus-continens/modus">GitHub</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/modus-continens/modus/issues">Issue Tracker</a>
        </li>
        <a class="nav-link" href="https://groups.google.com/g/modus-continens">Mailing List</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="modus-bg jumbotron">
  <div class="p-5">
    <div class="container">
      <div>
        <h1>Modus</h1>

        <!-- Place this tag where you want the button to render. -->
        <a class="github-button" href="https://github.com/modus-continens/modus" data-icon="octicon-star"
          data-size="large" data-show-count="true" aria-label="Star modus-continens/modus on GitHub">Star</a>

        <p>Modus is a Datalog dialect for building OCI container images and containerised task automation. Modus has the
          following goals:
        <ul>
          <li>
            <strong>Maintainability:</strong> make build definitions maintainable by enabling modularity, code reuse and
            automatic dependency resolution.
          </li>
          <li>
            <strong>Efficiency:</strong> make builds efficient by automatic parallelisation and fine-grained caching;
            provide tools for optimising the image size.
          </li>
          <li>
            <strong>Expressiveness:</strong> enable the user to express complex build workflows.
          </li>
          <li>
            <strong>Simplicity:</strong> provide minimalistic syntax, well-defined, non-Turing-complete semantics, and
            static build graphs.
          </li>
        </ul>
        </p>
        <!-- Place this tag where you want the button to render. -->
        <p>
          <a class="btn btn-primary mt-0" href="https://github.com/modus-continens/modus/blob/main/GETTING_STARTED.md"
            role="button">Getting Started &raquo;</a>
        </p>
      </div>
    </div>
  </div>
</div>

<div class="container mt-3">

  <div class="marketing">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Intuitive Build Model</h2>
        <p class="lead">The key insight of Modus is that the model of container image builds, as in <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a> and <a href="https://github.com/moby/buildkit">BuildKit</a>, naturally maps to the formalism of <a href="https://en.wikipedia.org/wiki/Horn_clause">Horn clauses</a>. Modus is a dialect of <a href="https://en.wikipedia.org/wiki/Datalog">Datalog</a>, a practical, non-Turing-complete implementation of Horn clauses, with domain-specific extensions for container builds.</p>
      </div>
      <div class="col-lg-6 col-md-12">
Dockerfile:
        <pre><code class="language-dockerfile">
FROM ubuntu:20.04 AS base
RUN apt-get update && apt-get install -y package-foo \
    && rm -rf /var/lib/apt/lists/*

RUN base AS app
COPY src .
RUN cd src && make install
        </code></pre>
Equivalent Modusfile:
        <pre><code class="language-python">
base :-
    from("ubuntu:20.04"),
    run("apt-get update && apt-get install -y package-foo \
         && rm -rf /var/lib/apt/lists/*").
app :-
    base,
    copy("src", "."),
    run("cd src && make install").
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Parameterised Builds</h2>
        <p class="lead">Container images are intrinsically parameterised. For example, the image <code>python:3.9-slim-bullseye</code> is parameterised with the Python version <code>3.9</code> and the distribution options <code>slim</code> and <code>bullseye</code>. Being a Datalog dialect, Modus explicitly handles image parameters.</p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
# The pylint image predicate is parameterised with
# Python's version, and Ubuntu's version.
pylint(python_version, "ubuntu", ubuntu_version) :-
    python(python_version, "ubuntu", ubuntu_version),
    run("pip install pylint").

python(python_version, "ubuntu", distr_version) :-
    # Formatted strings are used to simplify string manipulation:
    from(f"ubuntu:${distr_version}"),
    run(f"apt-get install -y python${python_version}").
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Dependency Resolution</h2>
        <p class="lead">Image parameters affect the sequence of operations required to build the target image. Modus enables the user to describe complex interactions between image parameters. It then uses a Datalog solver to resolve dependencies and statically compute the build graph.</p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
python(python_version, "fedora", distr_version) :-
    from(f"fedora:${distr_version}"),
    run(f"dnf install python${python_version}").

python(python_version, "ubuntu", distr_version) :-
    (distr_version = "16.04"; distr_version = "18.04"; distr_version = "20.04"),
    from(f"ubuntu:${distr_version}"),
    run(f"apt-get install -y python${python_version}").

# Ubuntu 14.04 requires adding third-party repositories to
# install recent versions of Python
python(python_version, "ubuntu", "14.04") :-
    from(f"ubuntu:${distr_version}"),
    run(f"apt-get install -y software-properties-common && \
          add-apt-repository ppa:deadsnakes/ppa && \
          apt-get update && \
          apt-get install -y python${python_version}").
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Standard Library</h2>
        <p class="lead">Modus provides a library of builtin predicates to handle common data structure in your build logic. For example, the predicate <code>semver_geq</code> checks if the left version is greater or equal to the right version according to <a href="https://semver.org/">SemVer</a> specification.</p>
        <p><a href="https://docs.modus-continens.com/library/">List of builtin predicates &raquo;</a></p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
python(python_version, "ubuntu", distr_version) :-
    # The rule is applied if Ubuntu's version is greater or equal to 16.04
    semver_geq(distr_version, "16.04"),
    from(f"ubuntu:${distr_version}"),
    run(f"apt-get install -y python${python_version}").
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Parallel Builds</h2>
        <p class="lead">Thanks to static computation of the build graph, Modus aggressively parallelises build execution. It also allows building multiple images at the same time.</p>
        <p class="lead">In this example, the build query <code>python("3.8", "ubuntu", X), semver_geq(X, "18.04")</code> for the previously introduced Modusfile resulted in the parallel build of two images: <code>python("3.8", "ubuntu", "20.04")</code> and <code>python("3.8", "ubuntu", "18.04")</code>.</p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-shell">
$ modus build . 'python("3.8", "ubuntu", X), semver_geq(X, "18.04")'
Exporting 1/2: python("3.8", "ubuntu", "20.04")
sha256:220611111e8c9bbe242e9dc1367c0fa89eef83f26203ee3f7c3764046e02b248
Exporting 2/2: python("3.8", "ubuntu", "18.04")
sha256:c34ce3c1fcc0c7431e1392cc3abd0dfe2192ffea1898d5250f199d3ac8d8720f
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">OCI Image Properties and Build Instructions</h2>
        <p class="lead">Modus provides a library of operators, such as <code>::copy</code> for <a href="https://docs.docker.com/develop/develop-images/multistage-build/"></a>multi-stage builds, that encapsulate build-specific instructions and manipulation of OCI image properties.</p>
        <p><a href="https://docs.modus-continens.com/library/">List of operators &raquo;</a></p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
builder(go_version) :-
    from(f"golang:${go_version}")
        ::set_workdir("/go/src/github.com/alexellis/href-counter/"),
    run("go get -d -v golang.org/x/net/html"),
    copy("app.go", "."),
    # Executing the build command in a specific environment:
    run("go build -a -installsuffix cgo -o app .")
        ::in_env("CGO_ENABLED", "0")
        ::in_env("GOOS", "linux").

release :- (
        from("alpine:latest")::set_workdir("/root"),
        run("apk --no-cache add ca-certificates"),
        # Copying files from another image for multi-stage build:
        builder("1.16")::copy("/go/src/github.com/alexellis/href-counter/app", ".")
    )::set_entrypoint("./app").
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Optimising Image Size</h2>
        <p class="lead">Encoding precise dependencies helps to optimise the resulting image size. Besides, Modus provides additional tools to reduce the image size such as the operator <code>::merge</code> that merges arbitrary number of layers into one.</p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
app(optimisation) :-
    from("gcc:latest"),
    # The following code will produce a single layer,
    # therefore the directory "src" will not be in the resulting image:
    (
        copy("src", "."),
        (optimisation = "on", run("cd src; make install-opt");
         optimisation = "off", run("cd src; make install")),
        run("rm -rf src")
    )::merge.
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">User-Defined Commands</h2>
        <p class="lead">Modus allow users to define their own commands, such as layer building functions or logical predicates, which facilitates modularity and code reuse.</p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
# User-defined layer predicate for installing libraries
install(lib, version) :-
    run(f"wget https://example.com/releases/${lib}-v${version}.tar.gz && \
          tar xf ${lib}-v${version}.tar.gz && \
          mv ${lib}-v${version}/ /build"),
    run("cd /build && make install"),
    run(f"rm ${lib}-v${version}.tar.gz && \
          rm -rf /build").

app :-
    from("gcc:latest"),
    (
        install("liba", "1.3.5"),
        install("libb", "4.1")
    )::merge.
        </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">

    <div class="row">
      <div class="col-lg-6 col-md-12">
        <h2 class="featurette-heading">Fine-grained Caching <span class="badge bg-warning">WIP</span></h2>
        <p class="lead">Modus allow users to define custom cache invalidation predicates to ensure predictable cache behavior and optimise build time.</p>
      </div>
      <div class="col-lg-6 col-md-12">
        <pre><code class="language-python">
We need some initial example href-counter
         </code></pre>
      </div>
    </div>

    <hr class="featurette-divider">


  </div>

  <footer>
    <p>Modus is distributed under <a href="https://www.gnu.org/licenses/agpl-3.0.txt">GNU Affero General Public
        License v3.0</a>. &copy; 2022 University College London.</p>
  </footer>

</div>

</main>


<script src="assets/dist/js/bootstrap.bundle.min.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://unpkg.com/prismjs@v1.x/components/prism-core.min.js"></script>
<script src="https://unpkg.com/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script>

</body>

</html>